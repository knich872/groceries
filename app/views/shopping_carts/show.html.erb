<div class="container">
  <div>
    <h1>This is my shopping cart</h1>
    <%= link_to "Back to my shopping carts", shopping_carts_path(filter: current_user.id) %>
  </div>
  <h3><%= @shopping_cart.name %></h3>
  <% unless current_user.shopping_cart_ids.include?(@shopping_cart.id) %>
    <%#= link_to "Join", new_shopping_cart_cart_member_path(@shopping_cart), class: "btn btn-food" %>
    <%= simple_form_for [@shopping_cart, @cart_member] do |f| %>
      <div class="form-inputs">
      </div>
      <div class="form-actions">
        <%= f.button :submit, "Join this cart", class: "btn btn-food" %>
      </div>
    <% end %>
  <% end %>
  <h5>Members in this cart</h2>
  <ul>
    <% @shopping_cart.cart_members.each do |member| %>
      <% user = member.user_id %>
      <li>
        <%= @users.find(user).username %>
      </li>
    <% end %>
  </ul>
  <br>
  <br>
  <div class="row d-flex">
    <div class="col-lg-9">
      <h5>Items in this cart</h5>
      <div class="row d-flex flex-wrap">
        <% @cart_items.each do |cart_item| %>
          <% if cart_item.bought == false %>
            <div class="col-lg-3 col-6">
              <div class="card">
                <% cart_item.item.photos.each do |photo| %>
                  <%= cl_image_tag(photo.key, height: 0.25, crop: :scale) %>
                <% end %>
                <p class="mb-0"><%= cart_item.item.name %></p>
                <p class="mb-0">Added by: <%= cart_item.added_by %></p>
                <% unless cart_item.bought?%>
                  <%#= simple_form_for cart_item, html: { class: "buy-form"} do |f| %>
                    <%#= f.input :bought, as: :hidden, input_html: { value: true } %>
                    <%#= f.input :bought_by, as: :hidden, input_html: { value: current_user.username } %>
                    <%#= f.submit 'Buy this item', class: 'btn btn-food' %>
                  <%# end %>
                <% end %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
    <div class="col-lg-3">
    <h5>Items recently purchased</h5>
      <ul>
        <% @cart_items.where('updated_at > ?', 24.hours.ago).each do |cart_item| %>
          <% if cart_item.bought == true %>
            <li>
              <div class="container">
                <div class="row">
                  <div class="d-flex">
                    <p><%= cart_item.item.name %></p>
                    <div>
                      <% cart_item.item.photos.each do |photo| %>
                        <%= cl_image_tag(photo.key, width: 100, height: 100, crop: :fit) %>
                      <% end %>
                    </div>
                    <div class="row d-flex">
                      <p>Bought by: <%= cart_item.bought_by %><%= cart_item.updated_at.strftime(" on %m/%d at %I:%M%p") %></p>
                    </div>
                  </div>
                </div>
              </div>
            </li>
          <% end %>
        <% end %>
      </ul>
    </div>
  </div>
  <%= link_to "Back to shopping carts", shopping_carts_path, class: "btn btn-food" %>
  <% if current_user.shopping_cart_ids.include?(@shopping_cart.id) %>
    <%= link_to "Add a new item", new_item_path, class: "btn btn-food" %>
    <%= link_to "Search for items", items_path, class: "btn btn-food" %>
  <% end %>
    <%= %>
</div>
